{"version":3,"sources":["webpack:///node_modules/@ckeditor/ckeditor5-angular/fesm2015/ckeditor-ckeditor5-angular.js","webpack:///node_modules/@ckeditor/ckeditor5-watchdog/src/utils/getsubnodes.js","webpack:///node_modules/@ckeditor/ckeditor5-watchdog/src/utils/areconnectedthroughproperties.js","webpack:///node_modules/@ckeditor/ckeditor5-watchdog/src/watchdog.js","webpack:///node_modules/@ckeditor/ckeditor5-watchdog/src/editorwatchdog.js"],"names":["Éµ0","val","index","toString","slice","HEX_NUMBERS","Array","fill","map","uid","r1","Math","random","r2","r3","r4","CKEditorComponent","elementRef","ngZone","config","data","tagName","ready","change","blur","focus","error","initiallyDisabled","isEditorSettingData","id","editorInstance","isReadOnly","isDisabled","setDisabledState","editorWatchdog","watchdog","_watchdogs","get","editor","attachToWatchdog","remove","destroy","undefined","value","setData","editorElement","innerHTML","callback","cvaOnChange","cvaOnTouched","creator","element","runOutsideAngular","nativeElement","appendChild","create","run","emit","setUpEditorEvents","destructor","removeChild","emitError","document","createElement","getConfig","add","type","sourceElementOrData","on","_","itemId","setCreator","setDestructor","initialData","Error","Object","assign","modelDocument","model","viewDocument","editing","view","evt","getData","event","decorators","args","selector","template","providers","provide","useExisting","multi","ctorParameters","propDecorators","disabled","CKEditorModule","imports","declarations","exports","getSubNodes","head","excludedProperties","Set","nodes","subNodes","length","node","shift","has","shouldNodeBeSkipped","Symbol","iterator","n","push","err","key","prototype","call","typeOfNode","EventTarget","Event","areConnectedThroughProperties","target1","target2","excludedNodes","isObject","subNodes1","subNodes2","checkConnectionBetweenProps","prevNodeMap1","prevNodeMap","prevNodeMap2","sharedNode","connection","unshift","console","log","structure","Watchdog","crashes","state","_crashNumberLimit","crashNumberLimit","_now","Date","now","_minimumNonErrorTimePeriod","minimumNonErrorTimePeriod","_boundErrorHandler","reason","_handleError","_listeners","_restart","_creator","_destructor","_stopErrorHandling","eventName","filter","cb","callbacks","apply","window","addEventListener","removeEventListener","_shouldReactToError","message","stack","filename","lineno","colno","date","causesRestart","_shouldRestart","_fire","is","context","_isErrorComingFromThisItem","lastErrorTime","firstMeaningfulErrorTime","averageNonErrorTimePeriod","EditorWatchdog","Editor","watchdogConfig","_editor","_throttledSave","_save","bind","saveInterval","elementOrData","Promise","resolve","then","_destroy","_elementOrData","_data","_config","updatedConfig","_cloneEditorConfiguration","_lastDocumentVersion","version","_getData","flush","props","_excludedProps","getRootNames","rootName"],"mappings":"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;AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;UACqBkC,c;;;;;AACpB;AACD;AACA;AACA;AACC,gCAAaC,MAAb,EAA2C;AAAA;;AAAA,cAAtBC,cAAsB,uEAAL,EAAK;;AAAA;;AAC1C,qCAAOA,cAAP;AAEA;AACF;AACA;AACA;AACA;AACA;;AACE,iBAAKC,OAAL,GAAe,IAAf;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;;AACE,iBAAKC,cAAL,GAAsB,2DACrB,OAAKC,KAAL,CAAWC,IAAX,gCADqB,EAErB,OAAOJ,cAAc,CAACK,YAAtB,KAAuC,QAAvC,GAAkDL,cAAc,CAACK,YAAjE,GAAgF,IAF3D,CAAtB;AAKA;AACF;AACA;AACA;AACA;AACA;;AAEE;AACF;AACA;AACA;AACA;AACA;;AAEE;AACF;AACA;AACA;AACA;AACA;;AAEE;AACF;AACA;AACA;AACA;AACA;AAEE;;AACA,iBAAKlC,QAAL,GAAkB,UAAEmC,aAAF,EAAiB1K,MAAjB;AAAA,mBAA6BmK,MAAM,CAAC/H,MAAP,CAAesI,aAAf,EAA8B1K,MAA9B,CAA7B;AAAA,WAAlB;;AACA,iBAAKwI,WAAL,GAAmB,UAAArH,MAAM;AAAA,mBAAIA,MAAM,CAACG,OAAP,EAAJ;AAAA,WAAzB;;AArD0C;AAsD1C;AAED;AACD;AACA;AACA;AACA;AACA;;;;;eACC,eAAa;AACZ,mBAAO,KAAK+I,OAAZ;AACA;AAED;AACD;AACA;;;;eACC,eAAY;AACX,mBAAO,KAAKA,OAAZ;AACA;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;;;;iBACC,oBAAW;AAAA;;AACV,mBAAOM,OAAO,CAACC,OAAR,GACLC,IADK,CACC,YAAM;AACZ,oBAAI,CAACnD,KAAL,GAAa,cAAb;;AAC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","file":"default~components-admin-body-Author-Author-module~components-admin-body-publisher-publisher-module~~0ae09f18-es5.js","sourcesContent":["import { __awaiter } from 'tslib';\nimport { EventEmitter, Component, forwardRef, ElementRef, NgZone, Input, Output, NgModule } from '@angular/core';\nimport EditorWatchdog from '@ckeditor/ckeditor5-watchdog/src/editorwatchdog';\nimport { NG_VALUE_ACCESSOR, FormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\n/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md.\n */\n\n/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\nconst Éµ0 = (val, index) => ('0' + (index).toString(16)).slice(-2);\n// A copy of @ckeditor/ckeditor5-utils/src/uid.js\n// A hash table of hex numbers to avoid using toString() in uid() which is costly.\n// [ '00', '01', '02', ..., 'fe', 'ff' ]\nconst HEX_NUMBERS = new Array(256).fill(0)\n    .map(Éµ0);\n/**\n * Returns a unique id. The id starts with an \"e\" character and a randomly generated string of\n * 32 alphanumeric characters.\n *\n * **Note**: The characters the unique id is built from correspond to the hex number notation\n * (from \"0\" to \"9\", from \"a\" to \"f\"). In other words, each id corresponds to an \"e\" followed\n * by 16 8-bit numbers next to each other.\n *\n * @returns An unique id string.\n */\nfunction uid() {\n    // Let's create some positive random 32bit integers first.\n    //\n    // 1. Math.random() is a float between 0 and 1.\n    // 2. 0x100000000 is 2^32 = 4294967296.\n    // 3. >>> 0 enforces integer (in JS all numbers are floating point).\n    //\n    // For instance:\n    //\t\tMath.random() * 0x100000000 = 3366450031.853859\n    // but\n    //\t\tMath.random() * 0x100000000 >>> 0 = 3366450031.\n    const r1 = Math.random() * 0x100000000 >>> 0;\n    const r2 = Math.random() * 0x100000000 >>> 0;\n    const r3 = Math.random() * 0x100000000 >>> 0;\n    const r4 = Math.random() * 0x100000000 >>> 0;\n    // Make sure that id does not start with number.\n    return 'e' +\n        HEX_NUMBERS[r1 >> 0 & 0xFF] +\n        HEX_NUMBERS[r1 >> 8 & 0xFF] +\n        HEX_NUMBERS[r1 >> 16 & 0xFF] +\n        HEX_NUMBERS[r1 >> 24 & 0xFF] +\n        HEX_NUMBERS[r2 >> 0 & 0xFF] +\n        HEX_NUMBERS[r2 >> 8 & 0xFF] +\n        HEX_NUMBERS[r2 >> 16 & 0xFF] +\n        HEX_NUMBERS[r2 >> 24 & 0xFF] +\n        HEX_NUMBERS[r3 >> 0 & 0xFF] +\n        HEX_NUMBERS[r3 >> 8 & 0xFF] +\n        HEX_NUMBERS[r3 >> 16 & 0xFF] +\n        HEX_NUMBERS[r3 >> 24 & 0xFF] +\n        HEX_NUMBERS[r4 >> 0 & 0xFF] +\n        HEX_NUMBERS[r4 >> 8 & 0xFF] +\n        HEX_NUMBERS[r4 >> 16 & 0xFF] +\n        HEX_NUMBERS[r4 >> 24 & 0xFF];\n}\n\n/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md.\n */\nclass CKEditorComponent {\n    constructor(elementRef, ngZone) {\n        /**\n         * The configuration of the editor.\n         * See https://ckeditor.com/docs/ckeditor5/latest/api/module_core_editor_editorconfig-EditorConfig.html\n         * to learn more.\n         */\n        this.config = {};\n        /**\n         * The initial data of the editor. Useful when not using the ngModel.\n         * See https://angular.io/api/forms/NgModel to learn more.\n         */\n        this.data = '';\n        /**\n         * Tag name of the editor component.\n         *\n         * The default tag is 'div'.\n         */\n        this.tagName = 'div';\n        /**\n         * Fires when the editor is ready. It corresponds with the `editor#ready`\n         * https://ckeditor.com/docs/ckeditor5/latest/api/module_core_editor_editor-Editor.html#event-ready\n         * event.\n         */\n        this.ready = new EventEmitter();\n        /**\n         * Fires when the content of the editor has changed. It corresponds with the `editor.model.document#change`\n         * https://ckeditor.com/docs/ckeditor5/latest/api/module_engine_model_document-Document.html#event-change\n         * event.\n         */\n        this.change = new EventEmitter();\n        /**\n         * Fires when the editing view of the editor is blurred. It corresponds with the `editor.editing.view.document#blur`\n         * https://ckeditor.com/docs/ckeditor5/latest/api/module_engine_view_document-Document.html#event-event:blur\n         * event.\n         */\n        this.blur = new EventEmitter();\n        /**\n         * Fires when the editing view of the editor is focused. It corresponds with the `editor.editing.view.document#focus`\n         * https://ckeditor.com/docs/ckeditor5/latest/api/module_engine_view_document-Document.html#event-event:focus\n         * event.\n         */\n        this.focus = new EventEmitter();\n        /**\n         * Fires when the editor component crashes.\n         */\n        this.error = new EventEmitter();\n        /**\n         * If the component is readâonly before the editor instance is created, it remembers that state,\n         * so the editor can become readâonly once it is ready.\n         */\n        this.initiallyDisabled = false;\n        /**\n         * A lock flag preventing from calling the `cvaOnChange()` during setting editor data.\n         */\n        this.isEditorSettingData = false;\n        this.id = uid();\n        this.ngZone = ngZone;\n        this.elementRef = elementRef;\n    }\n    /**\n     * When set `true`, the editor becomes read-only.\n     * See https://ckeditor.com/docs/ckeditor5/latest/api/module_core_editor_editor-Editor.html#member-isReadOnly\n     * to learn more.\n     */\n    set disabled(isDisabled) {\n        this.setDisabledState(isDisabled);\n    }\n    get disabled() {\n        if (this.editorInstance) {\n            return this.editorInstance.isReadOnly;\n        }\n        return this.initiallyDisabled;\n    }\n    /**\n     * The instance of the editor created by this component.\n     */\n    get editorInstance() {\n        let editorWatchdog = this.editorWatchdog;\n        if (this.watchdog) {\n            // Temporarily use the `_watchdogs` internal map as the `getItem()` method throws\n            // an error when the item is not registered yet.\n            // See https://github.com/ckeditor/ckeditor5-angular/issues/177.\n            editorWatchdog = this.watchdog._watchdogs.get(this.id);\n        }\n        if (editorWatchdog) {\n            return editorWatchdog.editor;\n        }\n        return null;\n    }\n    // Implementing the AfterViewInit interface.\n    ngAfterViewInit() {\n        this.attachToWatchdog();\n    }\n    // Implementing the OnDestroy interface.\n    ngOnDestroy() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.watchdog) {\n                yield this.watchdog.remove(this.id);\n            }\n            else if (this.editorWatchdog && this.editorWatchdog.editor) {\n                yield this.editorWatchdog.destroy();\n                this.editorWatchdog = undefined;\n            }\n        });\n    }\n    // Implementing the ControlValueAccessor interface (only when binding to ngModel).\n    writeValue(value) {\n        // This method is called with the `null` value when the form resets.\n        // A component's responsibility is to restore to the initial state.\n        if (value === null) {\n            value = '';\n        }\n        // If already initialized.\n        if (this.editorInstance) {\n            // The lock mechanism prevents from calling `cvaOnChange()` during changing\n            // the editor state. See #139\n            this.isEditorSettingData = true;\n            this.editorInstance.setData(value);\n            this.isEditorSettingData = false;\n        }\n        // If not, wait for it to be ready; store the data.\n        else {\n            this.data = value;\n            // If the editor element is already available, then update its content.\n            // If the ngModel is used then the editor element should be updated directly here.\n            if (this.editorElement) {\n                this.editorElement.innerHTML = this.data;\n            }\n        }\n    }\n    // Implementing the ControlValueAccessor interface (only when binding to ngModel).\n    registerOnChange(callback) {\n        this.cvaOnChange = callback;\n    }\n    // Implementing the ControlValueAccessor interface (only when binding to ngModel).\n    registerOnTouched(callback) {\n        this.cvaOnTouched = callback;\n    }\n    // Implementing the ControlValueAccessor interface (only when binding to ngModel).\n    setDisabledState(isDisabled) {\n        // If already initialized.\n        if (this.editorInstance) {\n            this.editorInstance.isReadOnly = isDisabled;\n        }\n        // Store the state anyway to use it once the editor is created.\n        this.initiallyDisabled = isDisabled;\n    }\n    /**\n     * Creates the editor instance, sets initial editor data, then integrates\n     * the editor with the Angular component. This method does not use the `editor.setData()`\n     * because of the issue in the collaboration mode (#6).\n     */\n    attachToWatchdog() {\n        const creator = (element, config) => __awaiter(this, void 0, void 0, function* () {\n            return this.ngZone.runOutsideAngular(() => __awaiter(this, void 0, void 0, function* () {\n                this.elementRef.nativeElement.appendChild(element);\n                const editor = yield this.editor.create(element, config);\n                if (this.initiallyDisabled) {\n                    editor.isReadOnly = this.initiallyDisabled;\n                }\n                this.ngZone.run(() => {\n                    this.ready.emit(editor);\n                });\n                this.setUpEditorEvents(editor);\n                return editor;\n            }));\n        });\n        const destructor = (editor) => __awaiter(this, void 0, void 0, function* () {\n            yield editor.destroy();\n            this.elementRef.nativeElement.removeChild(this.editorElement);\n        });\n        const emitError = () => {\n            this.ngZone.run(() => {\n                this.error.emit();\n            });\n        };\n        const element = document.createElement(this.tagName);\n        const config = this.getConfig();\n        this.editorElement = element;\n        // Based on the presence of the watchdog decide how to initialize the editor.\n        if (this.watchdog) {\n            // When the context watchdog is passed add the new item to it based on the passed configuration.\n            this.watchdog.add({\n                id: this.id,\n                type: 'editor',\n                creator,\n                destructor,\n                sourceElementOrData: element,\n                config\n            });\n            this.watchdog.on('itemError', (_, { itemId }) => {\n                if (itemId === this.id) {\n                    emitError();\n                }\n            });\n        }\n        else {\n            // In the other case create the watchdog by hand to keep the editor running.\n            const editorWatchdog = new EditorWatchdog(this.editor);\n            editorWatchdog.setCreator(creator);\n            editorWatchdog.setDestructor(destructor);\n            editorWatchdog.on('error', emitError);\n            this.editorWatchdog = editorWatchdog;\n            this.editorWatchdog.create(element, config);\n        }\n    }\n    getConfig() {\n        if (this.data && this.config.initialData) {\n            throw new Error('Editor data should be provided either using `config.initialData` or `data` properties.');\n        }\n        // Merge two possible ways of providing data into the `config.initialData` field.\n        return Object.assign(Object.assign({}, this.config), { initialData: this.config.initialData || this.data || '' });\n    }\n    /**\n     * Integrates the editor with the component by attaching related event listeners.\n     */\n    setUpEditorEvents(editor) {\n        const modelDocument = editor.model.document;\n        const viewDocument = editor.editing.view.document;\n        modelDocument.on('change:data', (evt) => {\n            this.ngZone.run(() => {\n                if (this.cvaOnChange && !this.isEditorSettingData) {\n                    const data = editor.getData();\n                    this.cvaOnChange(data);\n                }\n                this.change.emit({ event: evt, editor });\n            });\n        });\n        viewDocument.on('focus', (evt) => {\n            this.ngZone.run(() => {\n                this.focus.emit({ event: evt, editor });\n            });\n        });\n        viewDocument.on('blur', (evt) => {\n            this.ngZone.run(() => {\n                if (this.cvaOnTouched) {\n                    this.cvaOnTouched();\n                }\n                this.blur.emit({ event: evt, editor });\n            });\n        });\n    }\n}\nCKEditorComponent.decorators = [\n    { type: Component, args: [{\n                selector: 'ckeditor',\n                template: '<ng-template></ng-template>',\n                // Integration with @angular/forms.\n                providers: [\n                    {\n                        provide: NG_VALUE_ACCESSOR,\n                        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n                        useExisting: forwardRef(() => CKEditorComponent),\n                        multi: true\n                    }\n                ]\n            },] }\n];\nCKEditorComponent.ctorParameters = () => [\n    { type: ElementRef },\n    { type: NgZone }\n];\nCKEditorComponent.propDecorators = {\n    editor: [{ type: Input }],\n    config: [{ type: Input }],\n    data: [{ type: Input }],\n    tagName: [{ type: Input }],\n    watchdog: [{ type: Input }],\n    disabled: [{ type: Input }],\n    ready: [{ type: Output }],\n    change: [{ type: Output }],\n    blur: [{ type: Output }],\n    focus: [{ type: Output }],\n    error: [{ type: Output }]\n};\n\n/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md.\n */\nclass CKEditorModule {\n}\nCKEditorModule.decorators = [\n    { type: NgModule, args: [{\n                imports: [FormsModule, CommonModule],\n                declarations: [CKEditorComponent],\n                exports: [CKEditorComponent]\n            },] }\n];\n\n/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md.\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { CKEditorComponent, CKEditorModule };\n//# sourceMappingURL=ckeditor-ckeditor5-angular.js.map\n","/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module watchdog/utils/getsubnodes\n */\n\n/* globals EventTarget, Event */\n\nexport default function getSubNodes( head, excludedProperties = new Set() ) {\n\tconst nodes = [ head ];\n\n\t// @if CK_DEBUG_WATCHDOG // const prevNodeMap = new Map();\n\n\t// Nodes are stored to prevent infinite looping.\n\tconst subNodes = new Set();\n\n\twhile ( nodes.length > 0 ) {\n\t\tconst node = nodes.shift();\n\n\t\tif ( subNodes.has( node ) || shouldNodeBeSkipped( node ) || excludedProperties.has( node ) ) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tsubNodes.add( node );\n\n\t\t// Handle arrays, maps, sets, custom collections that implements `[ Symbol.iterator ]()`, etc.\n\t\tif ( node[ Symbol.iterator ] ) {\n\t\t\t// The custom editor iterators might cause some problems if the editor is crashed.\n\t\t\ttry {\n\t\t\t\tfor ( const n of node ) {\n\t\t\t\t\tnodes.push( n );\n\n\t\t\t\t\t// @if CK_DEBUG_WATCHDOG // if ( !prevNodeMap.has( n ) ) {\n\t\t\t\t\t// @if CK_DEBUG_WATCHDOG // \tprevNodeMap.set( n, node );\n\t\t\t\t\t// @if CK_DEBUG_WATCHDOG // }\n\t\t\t\t}\n\t\t\t} catch ( err ) {\n\t\t\t\t// Do not log errors for broken structures\n\t\t\t\t// since we are in the error handling process already.\n\t\t\t\t// eslint-disable-line no-empty\n\t\t\t}\n\t\t} else {\n\t\t\tfor ( const key in node ) {\n\t\t\t\t// We share a reference via the protobuf library within the editors,\n\t\t\t\t// hence the shared value should be skipped. Although, it's not a perfect\n\t\t\t\t// solution since new places like that might occur in the future.\n\t\t\t\tif ( key === 'defaultValue' ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tnodes.push( node[ key ] );\n\n\t\t\t\t// @if CK_DEBUG_WATCHDOG // if ( !prevNodeMap.has( node[ key ] ) ) {\n\t\t\t\t// @if CK_DEBUG_WATCHDOG // \tprevNodeMap.set( node[ key ], node );\n\t\t\t\t// @if CK_DEBUG_WATCHDOG // }\n\t\t\t}\n\t\t}\n\t}\n\n\t// @if CK_DEBUG_WATCHDOG // return { subNodes, prevNodeMap };\n\n\treturn subNodes;\n}\n\nfunction shouldNodeBeSkipped( node ) {\n\tconst type = Object.prototype.toString.call( node );\n\tconst typeOfNode = typeof node;\n\n\treturn (\n\t\ttypeOfNode === 'number' ||\n\t\ttypeOfNode === 'boolean' ||\n\t\ttypeOfNode === 'string' ||\n\t\ttypeOfNode === 'symbol' ||\n\t\ttypeOfNode === 'function' ||\n\t\ttype === '[object Date]' ||\n\t\ttype === '[object RegExp]' ||\n\t\ttype === '[object Module]' ||\n\n\t\tnode === undefined ||\n\t\tnode === null ||\n\n\t\t// Skip native DOM objects, e.g. Window, nodes, events, etc.\n\t\tnode instanceof EventTarget ||\n\t\tnode instanceof Event\n\t);\n}\n","/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module watchdog/utils/areconnectedthroughproperties\n */\n\n/* globals console */\n\nimport getSubNodes from './getsubnodes';\n\n/**\n * Traverses both structures to find out whether there is a reference that is shared between both structures.\n *\n * @param {Object|Array} target1\n * @param {Object|Array} target2\n */\nexport default function areConnectedThroughProperties( target1, target2, excludedNodes = new Set() ) {\n\tif ( target1 === target2 && isObject( target1 ) ) {\n\t\treturn true;\n\t}\n\n\t// @if CK_DEBUG_WATCHDOG // return checkConnectionBetweenProps( target1, target2, excludedNodes );\n\n\tconst subNodes1 = getSubNodes( target1, excludedNodes );\n\tconst subNodes2 = getSubNodes( target2, excludedNodes );\n\n\tfor ( const node of subNodes1 ) {\n\t\tif ( subNodes2.has( node ) ) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/* istanbul ignore next */\n// eslint-disable-next-line\nfunction checkConnectionBetweenProps( target1, target2, excludedNodes ) {\n\tconst { subNodes: subNodes1, prevNodeMap: prevNodeMap1 } = getSubNodes( target1, excludedNodes.subNodes );\n\tconst { subNodes: subNodes2, prevNodeMap: prevNodeMap2 } = getSubNodes( target2, excludedNodes.subNodes );\n\n\tfor ( const sharedNode of subNodes1 ) {\n\t\tif ( subNodes2.has( sharedNode ) ) {\n\t\t\tconst connection = [];\n\n\t\t\tconnection.push( sharedNode );\n\n\t\t\tlet node = prevNodeMap1.get( sharedNode );\n\n\t\t\twhile ( node && node !== target1 ) {\n\t\t\t\tconnection.push( node );\n\t\t\t\tnode = prevNodeMap1.get( node );\n\t\t\t}\n\n\t\t\tnode = prevNodeMap2.get( sharedNode );\n\n\t\t\twhile ( node && node !== target2 ) {\n\t\t\t\tconnection.unshift( node );\n\t\t\t\tnode = prevNodeMap2.get( node );\n\t\t\t}\n\n\t\t\tconsole.log( '--------' );\n\t\t\tconsole.log( { target1 } );\n\t\t\tconsole.log( { sharedNode } );\n\t\t\tconsole.log( { target2 } );\n\t\t\tconsole.log( { connection } );\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nfunction isObject( structure ) {\n\treturn typeof structure === 'object' && structure !== null;\n}\n","/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module watchdog/watchdog\n */\n\n/* globals window */\n\n/**\n * An abstract watchdog class that handles most of the error handling process and the state of the underlying component.\n *\n * See the {@glink features/watchdog Watchdog feature guide} to learn the rationale behind it and how to use it.\n *\n * @private\n * @abstract\n */\nexport default class Watchdog {\n\t/**\n\t * @param {module:watchdog/watchdog~WatchdogConfig} config The watchdog plugin configuration.\n\t */\n\tconstructor( config ) {\n\t\t/**\n\t\t * An array of crashes saved as an object with the following properties:\n\t\t *\n\t\t * * `message`: `String`,\n\t\t * * `stack`: `String`,\n\t\t * * `date`: `Number`,\n\t\t * * `filename`: `String | undefined`,\n\t\t * * `lineno`: `Number | undefined`,\n\t\t * * `colno`: `Number | undefined`,\n\t\t *\n\t\t * @public\n\t\t * @readonly\n\t\t * @type {Array.<Object>}\n\t\t */\n\t\tthis.crashes = [];\n\n\t\t/**\n\t\t * Specifies the state of the item watched by the watchdog. The state can be one of the following values:\n\t\t *\n\t\t * * `initializing` &ndash; Before the first initialization, and after crashes, before the item is ready.\n\t\t * * `ready` &ndash; A state when the user can interact with the item.\n\t\t * * `crashed` &ndash; A state when an error occurs. It quickly changes to `initializing` or `crashedPermanently`\n\t\t * depending on how many and how frequent errors have been caught recently.\n\t\t * * `crashedPermanently` &ndash; A state when the watchdog stops reacting to errors and keeps the item it is watching crashed,\n\t\t * * `destroyed` &ndash; A state when the item is manually destroyed by the user after calling `watchdog.destroy()`.\n\t\t *\n\t\t * @public\n\t\t * @type {'initializing'|'ready'|'crashed'|'crashedPermanently'|'destroyed'}\n\t\t */\n\t\tthis.state = 'initializing';\n\n\t\t/**\n\t\t * @protected\n\t\t * @type {Number}\n\t\t * @see module:watchdog/watchdog~WatchdogConfig\n\t\t */\n\t\tthis._crashNumberLimit = typeof config.crashNumberLimit === 'number' ? config.crashNumberLimit : 3;\n\n\t\t/**\n\t\t * Returns the result of the `Date.now()` call. It can be overridden in tests to mock time as some popular\n\t\t * approaches like `sinon.useFakeTimers()` do not work well with error handling.\n\t\t *\n\t\t * @protected\n\t\t */\n\t\tthis._now = Date.now;\n\n\t\t/**\n\t\t * @protected\n\t\t * @type {Number}\n\t\t * @see module:watchdog/watchdog~WatchdogConfig\n\t\t */\n\t\tthis._minimumNonErrorTimePeriod = typeof config.minimumNonErrorTimePeriod === 'number' ? config.minimumNonErrorTimePeriod : 5000;\n\n\t\t/**\n\t\t * Checks if the event error comes from the underlying item and restarts the item.\n\t\t *\n\t\t * @private\n\t\t * @type {Function}\n\t\t */\n\t\tthis._boundErrorHandler = evt => {\n\t\t\t// `evt.error` is exposed by EventError while `evt.reason` is available in PromiseRejectionEvent.\n\t\t\tconst error = evt.error || evt.reason;\n\n\t\t\t// Note that `evt.reason` might be everything that is in the promise rejection.\n\t\t\t// Similarly everything that is thrown lands in `evt.error`.\n\t\t\tif ( error instanceof Error ) {\n\t\t\t\tthis._handleError( error, evt );\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * The creation method.\n\t\t *\n\t\t * @protected\n\t\t * @member {Function} #_creator\n\t\t * @see #setCreator\n\t\t */\n\n\t\t/**\n\t\t * The destruction method.\n\t\t *\n\t\t * @protected\n\t\t * @member {Function} #_destructor\n\t\t * @see #setDestructor\n\t\t */\n\n\t\t/**\n\t\t * The watched item.\n\t\t *\n\t\t * @abstract\n\t\t * @protected\n\t\t * @member {Object|undefined} #_item\n\t\t */\n\n\t\t/**\n\t\t * The method responsible for restarting the watched item.\n\t\t *\n\t\t * @abstract\n\t\t * @protected\n\t\t * @method #_restart\n\t\t */\n\n\t\t/**\n\t\t * Traverses the error context and the watched item to find out whether the error should\n\t\t * be handled by the given item.\n\t\t *\n\t\t * @abstract\n\t\t * @protected\n\t\t * @method #_isErrorComingFromThisItem\n\t\t * @param {module:utils/ckeditorerror~CKEditorError} error\n\t\t */\n\n\t\t/**\n\t\t * A dictionary of event emitter listeners.\n\t\t *\n\t\t * @private\n\t\t * @type {Object.<String,Array.<Function>>}\n\t\t */\n\t\tthis._listeners = {};\n\n\t\tif ( !this._restart ) {\n\t\t\tthrow new Error(\n\t\t\t\t'The Watchdog class was split into the abstract `Watchdog` class and the `EditorWatchdog` class. ' +\n\t\t\t\t'Please, use `EditorWatchdog` if you have used the `Watchdog` class previously.'\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the function that is responsible for creating watched items.\n\t *\n\t * @param {Function} creator A callback responsible for creating an item. Returns a promise\n\t * that is resolved when the item is created.\n\t */\n\tsetCreator( creator ) {\n\t\tthis._creator = creator;\n\t}\n\n\t/**\n\t * Sets the function that is responsible for destroying watched items.\n\t *\n\t * @param {Function} destructor A callback that takes the item and returns the promise\n\t * to the destroying process.\n\t */\n\tsetDestructor( destructor ) {\n\t\tthis._destructor = destructor;\n\t}\n\n\t/**\n\t * Destroys the watchdog and releases the resources.\n\t */\n\tdestroy() {\n\t\tthis._stopErrorHandling();\n\n\t\tthis._listeners = {};\n\t}\n\n\t/**\n\t * Starts listening to a specific event name by registering a callback that will be executed\n\t * whenever an event with a given name fires.\n\t *\n\t * Note that this method differs from the CKEditor 5's default `EventEmitterMixin` implementation.\n\t *\n\t * @param {String} eventName The event name.\n\t * @param {Function} callback A callback which will be added to event listeners.\n\t */\n\ton( eventName, callback ) {\n\t\tif ( !this._listeners[ eventName ] ) {\n\t\t\tthis._listeners[ eventName ] = [];\n\t\t}\n\n\t\tthis._listeners[ eventName ].push( callback );\n\t}\n\n\t/**\n\t * Stops listening to the specified event name by removing the callback from event listeners.\n\t *\n\t * Note that this method differs from the CKEditor 5's default `EventEmitterMixin` implementation.\n\t *\n\t * @param {String} eventName The event name.\n\t * @param {Function} callback A callback which will be removed from event listeners.\n\t */\n\toff( eventName, callback ) {\n\t\tthis._listeners[ eventName ] = this._listeners[ eventName ]\n\t\t\t.filter( cb => cb !== callback );\n\t}\n\n\t/**\n\t * Fires an event with a given event name and arguments.\n\t *\n\t * Note that this method differs from the CKEditor 5's default `EventEmitterMixin` implementation.\n\t *\n\t * @protected\n\t * @param {String} eventName The event name.\n\t * @param  {...*} args Event arguments.\n\t */\n\t_fire( eventName, ...args ) {\n\t\tconst callbacks = this._listeners[ eventName ] || [];\n\n\t\tfor ( const callback of callbacks ) {\n\t\t\tcallback.apply( this, [ null, ...args ] );\n\t\t}\n\t}\n\n\t/**\n\t * Starts error handling by attaching global error handlers.\n\t *\n\t * @protected\n\t */\n\t_startErrorHandling() {\n\t\twindow.addEventListener( 'error', this._boundErrorHandler );\n\t\twindow.addEventListener( 'unhandledrejection', this._boundErrorHandler );\n\t}\n\n\t/**\n\t * Stops error handling by detaching global error handlers.\n\t *\n\t * @protected\n\t */\n\t_stopErrorHandling() {\n\t\twindow.removeEventListener( 'error', this._boundErrorHandler );\n\t\twindow.removeEventListener( 'unhandledrejection', this._boundErrorHandler );\n\t}\n\n\t/**\n\t * Checks if an error comes from the watched item and restarts it.\n\t * It reacts to {@link module:utils/ckeditorerror~CKEditorError `CKEditorError` errors} only.\n\t *\n\t * @private\n\t * @fires error\n\t * @param {Error} error Error.\n\t * @param {ErrorEvent|PromiseRejectionEvent} evt An error event.\n\t */\n\t_handleError( error, evt ) {\n\t\t// @if CK_DEBUG // if ( error.is && error.is( 'CKEditorError' ) && error.context === undefined ) {\n\t\t// @if CK_DEBUG // console.warn( 'The error is missing its context and Watchdog cannot restart the proper item.' );\n\t\t// @if CK_DEBUG // }\n\n\t\tif ( this._shouldReactToError( error ) ) {\n\t\t\tthis.crashes.push( {\n\t\t\t\tmessage: error.message,\n\t\t\t\tstack: error.stack,\n\n\t\t\t\t// `evt.filename`, `evt.lineno` and `evt.colno` are available only in ErrorEvent events\n\t\t\t\tfilename: evt.filename,\n\t\t\t\tlineno: evt.lineno,\n\t\t\t\tcolno: evt.colno,\n\t\t\t\tdate: this._now()\n\t\t\t} );\n\n\t\t\tconst causesRestart = this._shouldRestart();\n\n\t\t\tthis.state = 'crashed';\n\t\t\tthis._fire( 'stateChange' );\n\t\t\tthis._fire( 'error', { error, causesRestart } );\n\n\t\t\tif ( causesRestart ) {\n\t\t\t\tthis._restart();\n\t\t\t} else {\n\t\t\t\tthis.state = 'crashedPermanently';\n\t\t\t\tthis._fire( 'stateChange' );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks whether an error should be handled by the watchdog.\n\t *\n\t * @private\n\t * @param {Error} error An error that was caught by the error handling process.\n\t */\n\t_shouldReactToError( error ) {\n\t\treturn (\n\t\t\terror.is &&\n\t\t\terror.is( 'CKEditorError' ) &&\n\t\t\terror.context !== undefined &&\n\n\t\t\t// In some cases the watched item should not be restarted - e.g. during the item initialization.\n\t\t\t// That's why the `null` was introduced as a correct error context which does cause restarting.\n\t\t\terror.context !== null &&\n\n\t\t\t// Do not react to errors if the watchdog is in states other than `ready`.\n\t\t\tthis.state === 'ready' &&\n\n\t\t\tthis._isErrorComingFromThisItem( error )\n\t\t);\n\t}\n\n\t/**\n\t * Checks if the watchdog should restart the underlying item.\n\t *\n\t * @private\n\t */\n\t_shouldRestart() {\n\t\tif ( this.crashes.length <= this._crashNumberLimit ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst lastErrorTime = this.crashes[ this.crashes.length - 1 ].date;\n\t\tconst firstMeaningfulErrorTime = this.crashes[ this.crashes.length - 1 - this._crashNumberLimit ].date;\n\n\t\tconst averageNonErrorTimePeriod = ( lastErrorTime - firstMeaningfulErrorTime ) / this._crashNumberLimit;\n\n\t\treturn averageNonErrorTimePeriod > this._minimumNonErrorTimePeriod;\n\t}\n\n\t/**\n\t * Fired when a new {@link module:utils/ckeditorerror~CKEditorError `CKEditorError`} error connected to the watchdog instance occurs\n\t * and the watchdog will react to it.\n\t *\n\t * \twatchdog.on( 'error', ( evt, { error, causesRestart } ) => {\n\t * \t\tconsole.log( 'An error occurred.' );\n\t * \t} );\n\t *\n\t * @event error\n\t */\n}\n\n/**\n * The watchdog plugin configuration.\n *\n * @typedef {Object} WatchdogConfig\n *\n * @property {Number} [crashNumberLimit=3] A threshold specifying the number of watched item crashes\n * when the watchdog stops restarting the item in case of errors.\n * After this limit is reached and the time between the last errors is shorter than `minimumNonErrorTimePeriod`,\n * the watchdog changes its state to `crashedPermanently` and it stops restarting the item. This prevents an infinite restart loop.\n *\n * @property {Number} [minimumNonErrorTimePeriod=5000] An average number of milliseconds between the last watched item errors\n * (defaults to 5000). When the period of time between errors is lower than that and the `crashNumberLimit` is also reached,\n * the watchdog changes its state to `crashedPermanently` and it stops restarting the item. This prevents an infinite restart loop.\n *\n * @property {Number} [saveInterval=5000] A minimum number of milliseconds between saving the editor data internally (defaults to 5000).\n * Note that for large documents this might impact the editor performance.\n */\n","/**\n * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module watchdog/editorwatchdog\n */\n\n/* globals console */\n\nimport { throttle, cloneDeepWith, isElement } from 'lodash-es';\nimport areConnectedThroughProperties from './utils/areconnectedthroughproperties';\nimport Watchdog from './watchdog';\n\n/**\n * A watchdog for CKEditor 5 editors.\n *\n * See the {@glink features/watchdog Watchdog feature guide} to learn the rationale behind it and\n * how to use it.\n *\n * @extends {module:watchdog/watchdog~Watchdog}\n */\nexport default class EditorWatchdog extends Watchdog {\n\t/**\n\t * @param {*} Editor The editor class.\n\t * @param {module:watchdog/watchdog~WatchdogConfig} [watchdogConfig] The watchdog plugin configuration.\n\t */\n\tconstructor( Editor, watchdogConfig = {} ) {\n\t\tsuper( watchdogConfig );\n\n\t\t/**\n\t\t * The current editor instance.\n\t\t *\n\t\t * @private\n\t\t * @type {module:core/editor/editor~Editor}\n\t\t */\n\t\tthis._editor = null;\n\n\t\t/**\n\t\t * Throttled save method. The `save()` method is called the specified `saveInterval` after `throttledSave()` is called,\n\t\t * unless a new action happens in the meantime.\n\t\t *\n\t\t * @private\n\t\t * @type {Function}\n\t\t */\n\t\tthis._throttledSave = throttle(\n\t\t\tthis._save.bind( this ),\n\t\t\ttypeof watchdogConfig.saveInterval === 'number' ? watchdogConfig.saveInterval : 5000\n\t\t);\n\n\t\t/**\n\t\t * The latest saved editor data represented as a root name -> root data object.\n\t\t *\n\t\t * @private\n\t\t * @member {Object.<String,String>} #_data\n\t\t */\n\n\t\t/**\n\t\t * The last document version.\n\t\t *\n\t\t * @private\n\t\t * @member {Number} #_lastDocumentVersion\n\t\t */\n\n\t\t/**\n\t\t * The editor source element or data.\n\t\t *\n\t\t * @private\n\t\t * @member {HTMLElement|String|Object.<String|String>} #_elementOrData\n\t\t */\n\n\t\t/**\n\t\t * The editor configuration.\n\t\t *\n\t\t * @private\n\t\t * @member {Object|undefined} #_config\n\t\t */\n\n\t\t// Set default creator and destructor functions:\n\t\tthis._creator = ( ( elementOrData, config ) => Editor.create( elementOrData, config ) );\n\t\tthis._destructor = editor => editor.destroy();\n\t}\n\n\t/**\n\t * The current editor instance.\n\t *\n\t * @readonly\n\t * @type {module:core/editor/editor~Editor}\n\t */\n\tget editor() {\n\t\treturn this._editor;\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tget _item() {\n\t\treturn this._editor;\n\t}\n\n\t/**\n\t * Sets the function that is responsible for the editor creation.\n\t * It expects a function that should return a promise.\n\t *\n\t *\t\twatchdog.setCreator( ( element, config ) => ClassicEditor.create( element, config ) );\n\t *\n\t * @method #setCreator\n\t * @param {Function} creator\n\t */\n\n\t/**\n\t * Sets the function that is responsible for the editor destruction.\n\t * Overrides the default destruction function, which destroys only the editor instance.\n\t * It expects a function that should return a promise or `undefined`.\n\t *\n\t *\t\twatchdog.setDestructor( editor => {\n\t *\t\t\t// Do something before the editor is destroyed.\n\t *\n\t *\t\t\treturn editor\n\t *\t\t\t\t.destroy()\n\t *\t\t\t\t.then( () => {\n\t *\t\t\t\t\t// Do something after the editor is destroyed.\n\t *\t\t\t\t} );\n\t *\t\t} );\n\t *\n\t * @method #setDestructor\n\t * @param {Function} destructor\n\t */\n\n\t/**\n\t * Restarts the editor instance. This method is called whenever an editor error occurs. It fires the `restart` event and changes\n\t * the state to `initializing`.\n\t *\n\t * @protected\n\t * @fires restart\n\t * @returns {Promise}\n\t */\n\t_restart() {\n\t\treturn Promise.resolve()\n\t\t\t.then( () => {\n\t\t\t\tthis.state = 'initializing';\n\t\t\t\tthis._fire( 'stateChange' );\n\n\t\t\t\treturn this._destroy();\n\t\t\t} )\n\t\t\t.catch( err => {\n\t\t\t\tconsole.error( 'An error happened during the editor destroying.', err );\n\t\t\t} )\n\t\t\t.then( () => {\n\t\t\t\tif ( typeof this._elementOrData === 'string' ) {\n\t\t\t\t\treturn this.create( this._data, this._config, this._config.context );\n\t\t\t\t} else {\n\t\t\t\t\tconst updatedConfig = Object.assign( {}, this._config, {\n\t\t\t\t\t\tinitialData: this._data\n\t\t\t\t\t} );\n\n\t\t\t\t\treturn this.create( this._elementOrData, updatedConfig, updatedConfig.context );\n\t\t\t\t}\n\t\t\t} )\n\t\t\t.then( () => {\n\t\t\t\tthis._fire( 'restart' );\n\t\t\t} );\n\t}\n\n\t/**\n\t * Creates the editor instance and keeps it running, using the defined creator and destructor.\n\t *\n\t * @param {HTMLElement|String|Object.<String|String>} [elementOrData] The editor source element or the editor data.\n\t * @param {module:core/editor/editorconfig~EditorConfig} [config] The editor configuration.\n\t * @param {Object} [context] A context for the editor.\n\t *\n\t * @returns {Promise}\n\t */\n\tcreate( elementOrData = this._elementOrData, config = this._config, context ) {\n\t\treturn Promise.resolve()\n\t\t\t.then( () => {\n\t\t\t\tsuper._startErrorHandling();\n\n\t\t\t\tthis._elementOrData = elementOrData;\n\n\t\t\t\t// Clone configuration because it might be shared within multiple watchdog instances. Otherwise,\n\t\t\t\t// when an error occurs in one of these editors, the watchdog will restart all of them.\n\t\t\t\tthis._config = this._cloneEditorConfiguration( config ) || {};\n\n\t\t\t\tthis._config.context = context;\n\n\t\t\t\treturn this._creator( elementOrData, this._config );\n\t\t\t} )\n\t\t\t.then( editor => {\n\t\t\t\tthis._editor = editor;\n\n\t\t\t\teditor.model.document.on( 'change:data', this._throttledSave );\n\n\t\t\t\tthis._lastDocumentVersion = editor.model.document.version;\n\t\t\t\tthis._data = this._getData();\n\n\t\t\t\tthis.state = 'ready';\n\t\t\t\tthis._fire( 'stateChange' );\n\t\t\t} );\n\t}\n\n\t/**\n\t * Destroys the watchdog and the current editor instance. It fires the callback\n\t * registered in {@link #setDestructor `setDestructor()`} and uses it to destroy the editor instance.\n\t * It also sets the state to `destroyed`.\n\t *\n\t * @returns {Promise}\n\t */\n\tdestroy() {\n\t\treturn Promise.resolve()\n\t\t\t.then( () => {\n\t\t\t\tthis.state = 'destroyed';\n\t\t\t\tthis._fire( 'stateChange' );\n\n\t\t\t\tsuper.destroy();\n\n\t\t\t\treturn this._destroy();\n\t\t\t} );\n\t}\n\n\t/**\n\t * @private\n\t * @returns {Promise}\n\t */\n\t_destroy() {\n\t\treturn Promise.resolve()\n\t\t\t.then( () => {\n\t\t\t\tthis._stopErrorHandling();\n\n\t\t\t\t// Save data if there is a remaining editor data change.\n\t\t\t\tthis._throttledSave.flush();\n\n\t\t\t\tconst editor = this._editor;\n\n\t\t\t\tthis._editor = null;\n\n\t\t\t\treturn this._destructor( editor );\n\t\t\t} );\n\t}\n\n\t/**\n\t * Saves the editor data, so it can be restored after the crash even if the data cannot be fetched at\n\t * the moment of the crash.\n\t *\n\t * @private\n\t */\n\t_save() {\n\t\tconst version = this._editor.model.document.version;\n\n\t\t// Operation may not result in a model change, so the document's version can be the same.\n\t\tif ( version === this._lastDocumentVersion ) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tthis._data = this._getData();\n\t\t\tthis._lastDocumentVersion = version;\n\t\t} catch ( err ) {\n\t\t\tconsole.error(\n\t\t\t\terr,\n\t\t\t\t'An error happened during restoring editor data. ' +\n\t\t\t\t'Editor will be restored from the previously saved data.'\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * @protected\n\t * @param {Set} props\n\t */\n\t_setExcludedProperties( props ) {\n\t\tthis._excludedProps = props;\n\t}\n\n\t/**\n\t * Returns the editor data.\n\t *\n\t * @private\n\t * @returns {Object<String,String>}\n\t */\n\t_getData() {\n\t\tconst data = {};\n\n\t\tfor ( const rootName of this._editor.model.document.getRootNames() ) {\n\t\t\tdata[ rootName ] = this._editor.data.get( { rootName } );\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Traverses the error context and the current editor to find out whether these structures are connected\n\t * to each other via properties.\n\t *\n\t * @protected\n\t * @param {module:utils/ckeditorerror~CKEditorError} error\n\t */\n\t_isErrorComingFromThisItem( error ) {\n\t\treturn areConnectedThroughProperties( this._editor, error.context, this._excludedProps );\n\t}\n\n\t/**\n\t * Clones the editor configuration.\n\t *\n\t * @private\n\t * @param {Object} config\n\t */\n\t_cloneEditorConfiguration( config ) {\n\t\treturn cloneDeepWith( config, ( value, key ) => {\n\t\t\t// Leave DOM references.\n\t\t\tif ( isElement( value ) ) {\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tif ( key === 'context' ) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * Fired after the watchdog restarts the error in case of a crash.\n\t *\n\t * @event restart\n\t */\n}\n"]}